const w=[{tag:"Content Type",icon:"article",desc:"Type of content (Blog, Ad Copy, Email, etc.)"},{tag:"Brand Name",icon:"badge",desc:"Your business or brand name"},{tag:"About Brand",icon:"info",desc:"Short description of the brand"},{tag:"Brand Voice",icon:"record_voice_over",desc:"How the brand should sound"},{tag:"Content Tone",icon:"mood",desc:"Tone/style (Professional, Friendly, Bold, etc.)"},{tag:"USP",icon:"star",desc:"Unique selling points to highlight"},{tag:"Targeted Audience",icon:"group",desc:"Who the content is intended for"},{tag:"Targeted Location",icon:"location_on",desc:"City/Country to target for SEO"},{tag:"Primary Keyword",icon:"vpn_key",desc:"Main SEO keyword to focus on"},{tag:"Secondary Keyword",icon:"key",desc:"Additional keywords to include"},{tag:"Overall Reference",icon:"description",desc:"Reference or sample to follow"},{tag:"H1",icon:"title",desc:"Main Heading"},{tag:"H2",icon:"format_size",desc:"Subheadings"},{tag:"H3",icon:"text_fields",desc:"Additional smaller headings"},{tag:"H4",icon:"title",desc:"Minor subpoints"},{tag:"FAQ",icon:"help",desc:"Frequently asked questions to include"},{tag:"CTA",icon:"campaign",desc:"Call to action statement"},{tag:"Topic",icon:"topic",desc:"Main topic or idea for the content"},{tag:"Description",icon:"notes",desc:"Short description or summary"},{tag:"Words Needed",icon:"straighten",desc:"Required word count"},{tag:"Number of Paragraphs",icon:"list",desc:"How many sections/paragraphs needed"},{tag:"Internal Link",icon:"link",desc:"Links to internal pages for SEO"},{tag:"Reference Link",icon:"link_off",desc:"External links or sources to refer"},{tag:"Content Quality Instructions",icon:"checklist",desc:"Specific quality guidelines"}],v=document.getElementById("editor"),m=document.getElementById("suggestionsBox"),u=document.getElementById("suggestionsList"),x=document.getElementById("promptForm");let g=!1,r=0,y=null;L(w);v.addEventListener("keyup",t=>{if(["ArrowUp","ArrowDown","Enter","Escape"].includes(t.key))return;const e=window.getSelection();if(!e.rangeCount)return;const n=e.getRangeAt(0),o=(n.startContainer.textContent||"").substring(0,n.startOffset),s=o.lastIndexOf("/");if(g&&(t.key===" "||t.key==="Escape")){f();return}if(s!==-1&&(s===0||o[s-1]===" "||o[s-1]==="Â ")){const i=o.substring(s+1);y=n.cloneRange(),y.setStart(n.startContainer,s),y.setEnd(n.startContainer,n.startOffset),C(i),k()}else f()});v.addEventListener("keydown",t=>{if(!g){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),x.requestSubmit());return}const e=Array.from(u.querySelectorAll(".menu-item:not(.hidden)"));e.length!==0&&(t.key==="ArrowDown"?(t.preventDefault(),r=(r+1)%e.length,h(e)):t.key==="ArrowUp"?(t.preventDefault(),r=(r-1+e.length)%e.length,h(e)):t.key==="Enter"||t.key==="Tab"?(t.preventDefault(),e[r]&&T(e[r].dataset.tag)):t.key==="Escape"&&(t.preventDefault(),f()))});function h(t){t.forEach((e,n)=>{n===r?(e.classList.add("is-active"),e.scrollIntoView({block:"nearest",behavior:"smooth"})):e.classList.remove("is-active")})}function C(t){const e=t.toLowerCase();let n=0;u.querySelectorAll(".menu-item").forEach(o=>{o.dataset.tag.toLowerCase().includes(e)?(o.classList.remove("hidden"),n++):o.classList.add("hidden")}),n===0?f():(r=0,h(u.querySelectorAll(".menu-item:not(.hidden)")))}function k(){if(g)return;const t=window.getSelection();if(t.rangeCount>0){const e=t.getRangeAt(0).cloneRange();e.collapse(!0);const n=e.getBoundingClientRect(),l=v.getBoundingClientRect(),o=n.bottom-l.top+24,s=n.left-l.left;m.style.top=`${o}px`,m.style.left=`${s}px`}m.classList.remove("hidden"),g=!0,h(u.querySelectorAll(".menu-item:not(.hidden)"))}function f(){m.classList.add("hidden"),g=!1,r=0}function T(t){const e=window.getSelection();e.removeAllRanges(),e.addRange(y),document.execCommand("delete");const n=`&nbsp;<span class="smart-badge" contenteditable="false">${t}:</span>&nbsp;`;document.execCommand("insertHTML",!1,n),f()}function L(t){u.innerHTML=t.map(e=>`
            <div class="menu-item flex items-center gap-3 p-2.5 rounded-lg cursor-pointer transition-colors duration-150 hover:bg-gray-50" 
                 data-tag="${e.tag}"
                 onmousedown="event.preventDefault(); insertBadge('${e.tag}')">
                <div class="icon-box w-8 h-8 flex items-center justify-center rounded-md bg-gray-100 text-gray-500 transition-colors">
                    <span class="material-icons text-[18px]">${e.icon}</span>
                </div>
                <div>
                    <div class="font-semibold text-sm text-gray-800">${e.tag}</div>
                    <div class="text-xs text-gray-400">${e.desc}</div>
                </div>
            </div>
        `).join("")}x.addEventListener("submit",t=>{const e=document.getElementById("aiModel").value,n=["H1","H2","H3","H4","FAQ","CTA"],l=["Topic","Description","Words Needed","Number of Paragraphs","Internal Link","Reference Link","Content Quality Instructions"],o=[];let s=null,i=null;const E=a=>{const d=a.replace(/\u00A0/g," ").trim();d&&i&&(i.content=i.content?i.content+" "+d:d)};v.childNodes.forEach(a=>{if(a.nodeType===Node.TEXT_NODE)E(a.textContent);else if(a.nodeType===Node.ELEMENT_NODE)if(a.classList.contains("smart-badge")){const d=a.innerText.replace(":","").trim(),c={tag:d,content:""};n.includes(d)?(c.children=[],o.push(c),s=c,i=c):l.includes(d)?(s?s.children.push(c):o.push(c),i=c):(s=null,o.push(c),i=c)}else E(a.innerText||a.textContent)});const b={structure:o,model:e},p=document.createElement("input");p.type="hidden",p.name="prompt_payload",p.value=JSON.stringify(b),x.appendChild(p)});
